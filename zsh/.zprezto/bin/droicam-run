#!/usr/bin/sh

phone_ip="192.168.1.231"
port="4747"
droidcam_pid=$(pidof droidcam-cli)
ffmpeg_pid_store="/tmp/droidcam-listener-ffmpeg.pid"

if [ -z $droidcam_pid ]; then
    notify-send "start ðŸ“¸ droidcam-cli"

    # CONNECT TO PHONE DIRECTLY
    droidcam-cli -v $phone_ip $port >/dev/null & # manual

    # DO ALL FLIP'S AND FUCK OFF.
    ffmpeg -f v4l2 -i /dev/video1 -vf "crop=640:420,hflip,transpose=1,format=yuv420p" -f v4l2 /dev/video0 >/dev/null 2>&1 &

    # store PID to kill it and show icon in bar.
    ffmpeg_pid=$!
    echo $ffmpeg_pid >$ffmpeg_pid_store
else
    killall -9 droidcam-cli
    kill $(cat $ffmpeg_pid_store)
    rm -f $ffmpeg_pid_store
    notify-send "kill ðŸ’€ðŸ“¸  droidcam-cli"
fi
